# Ralph Progress Log
Started: Sat, 31 Jan 2026 02:32:26 GMT
---

## Codebase Patterns
- Database file stored as auth_helper.db in project root (auto-creates on first run)
- All database operations in src/database.py
- Pydantic models for validation in src/models.py (KeyCreate, KeyResponse, KeyOutput, OTPResponse)
- CRUD operations in src/crud.py (always exclude secret from responses)
- OTP generation logic in src/otp.py
- QR code parsing in src/qr.py
- FastAPI endpoints in src/main.py with exception handlers
- KeyCreate model validates type, algorithm, digits; auto-sets counter=0 for HOTP
- HOTP keys have period=None in DB, TOTP keys have counter=0 in DB
- Use tempfile for test databases to avoid test contamination

---

## 2026-01-31 - US-003 (Commit: 7cf9ebc)
- Created src/models.py with Pydantic models: KeyCreate, KeyResponse, KeyOutput, OTPResponse
- KeyCreate with defaults: algorithm=sha1, digits=6, period=30 for TOTP; counter=0 for HOTP
- KeyCreate validates type (totp/hotp), algorithm (sha1/sha256/sha512), digits (6/8)
- Created src/crud.py with CRUD operations: create_key, get_key_by_name, list_keys, delete_key, update_counter
- All CRUD operations exclude secret from responses (security)
- Graceful error handling for duplicate names and non-existent keys
- Comprehensive test coverage: 26 tests total (12 CRUD, 9 models, 5 database)
- Files changed: src/models.py, src/crud.py, tests/test_models.py, tests/test_crud.py
- **Patterns added to Codebase Patterns:** KeyCreate defaults, HOTP/TOTP DB structure
- **Learnings for future iterations:**
  - CRUD operations must exclude secret from all responses
  - Use tempfile for test databases to avoid contamination
  - HOTP counter defaults to 0, TOTP period defaults to 30

---

## 2026-01-31 - US-002 (Commit: 0cb1b1a)
- Created src/database.py with Database class for SQLite connection management
- Implemented get_connection() with lazy initialization and PRAGMA foreign_keys
- Implemented context manager support (__enter__, __exit__)
- Created init_db() function (idempotent) to initialize schema
- Keys table with columns: id (auto), name (unique), secret, type, algorithm, digits, period, counter, issuer, created_at
- Added CHECK constraints for type (totp/hotp), algorithm (sha1/sha256/sha512), digits (6/8)
- Database defaults: counter=0, created_at=CURRENT_TIMESTAMP
- Created comprehensive unit tests (5 tests, all passing):
  - Test database file creation
  - Test table creation
  - Test correct column types
  - Test unique constraint on name
  - Test idempotent init_db
- Files changed: src/database.py, tests/__init__.py, tests/test_database.py
- **Patterns added to Codebase Patterns:** Use Database class with context manager for all DB access
- **Learnings for future iterations:**
  - Database class uses lazy connection initialization
  - init_db() is idempotent - safe to call multiple times
  - Always use PRAGMA foreign_keys = ON
  - Tests use tempfile for isolated test databases

---

## 2026-01-31 - US-001 (Commit: d77216b)
- Created requirements.txt with all dependencies (fastapi, uvicorn, pyotp, pyzbar, Pillow, python-multipart, pytest, httpx)
- Created .gitignore for venv/, __pycache__/, *.pyc, *.db
- Created src/ directory structure for application code
- Added comprehensive README.md with setup instructions, prerequisites (libzbar0), and API examples
- Created run.sh script for easy service startup (activates venv, installs deps, runs uvicorn)
- Installed Python 3.12-venv and libzbar0 system packages
- Set up Python virtual environment with all dependencies installed
- Files changed: requirements.txt, .gitignore, README.md, run.sh, src/__init__.py, progress.txt
- **Patterns added to Codebase Patterns:** Database file location (auth_helper.db), module structure
- **Learnings for future iterations:**
  - System requires libzbar0 for QR code scanning
  - Virtual environment activation in run.sh uses source venv/bin/activate

---
